"use strict";define("editor-controller",["extlycore"],function(t){var a=function(a,r,n,u){var s=this;var i=a.editorCtrl;var l=u;var o=jQuery(".extly-body form");var c=o.serializeArray();var d=false;i.remainingCount=0;i.showDialog=false;i.addRequest=function(e){var t=i.description||"",a;var r,u={},c={},d=[],m=[];e.preventDefault();t=t.trim();if(t.length==0){i.showDialog=true;i.messageResult=false;i.messageText=n.trustAsHtml("Invalid field: Message");return}u["description"]=t;u["url"]=i.url;r=o.serializeArray();_.each(r,function(e){if(e.name=="postThis"){c["postthis"]=e.value}else if(e.name=="everGreen"){c["evergreen"]=e.value}else if(e.name=="channelchooser[]"){m.push(e.value)}else if(e.name=="unix_mhdmd"){c[e.name]=e.value}else if(e.name=="ref_id"){u[e.name]=e.value;c[e.name]=e.value}else if(e.name=="agenda[]"){d.push(e.value)}else if(e.name.match(/unix_mhdmd_/)||e.name=="scheduling_date"||e.name=="scheduling_time"||e.name=="postAttrs"||e.name=="selectedMenuItem"){}else{u[e.name]=e.value}});c["agenda"]=d;c["channels"]=m;c["channels_text"]=s.getChannelsText();c["image"]="";u["autotweet_advanced_attrs"]=JSON.stringify(c);if(i.plugin=="autotweetpost"){u["taskCommand"]="applyAjaxOwnAction"}else{u["taskCommand"]="applyAjaxPluginAction"}u["ajax"]=1;if(c["unix_mhdmd"]&&c["unix_mhdmd"].length>0&&d.length>1){s.error({status:"",statusText:"Repeat Expression not allowed for more than one Agenda date."});return false}i.waiting=true;a=new l(u);a.$save(null,s.success,s.error)};s.jQueryAddRequest=function(e){s.addRequest(e);a.$digest()};s.jQueryAddRequestAndRedirect=function(e){s.redirectOnSuccess=true;s.jQueryAddRequest(e)};s.getChannelsText=function(){var e=jQuery("#channelchooser option:selected"),t;t=_.reduce(e,function(e,t){var a=jQuery(t).text();if(e==""){return a}else{return e+", "+a}},"");return t};i.countRemaining=function(){i.remainingCount=140-i.description.length};s.success=function(e){s.reset();i.showDialog=true;i.messageResult=e.status;i.messageText=n.trustAsHtml(e.message);i.request_id=0;i.ref_id=e.hash;i.waiting=false;r.$emit("newRequest");if(e.status&&s.redirectOnSuccess){Joomla.submitbutton("cancel")}s.redirectOnSuccess=false};s.load=function(e){var a=JSON.parse(e.native_object);s.reset();i.waiting=false;i.showDialog=false;i.messageResult="success";i.messageText=n.trustAsHtml("-Loaded-");i.description=e.description;i.url=e.url;i.request_id=e.id;i.ref_id=e.ref_id;i.plugin=e.plugin;if(e.autotweet_advanced_attrs){r.$emit("loadAgenda",e.autotweet_advanced_attrs.agenda)}jQuery("#image_url").val(e.image_url);jRefreshPreview("","image_url");if(e.autotweet_advanced_attrs){jQuery("#itemeditor_postthis").val(e.autotweet_advanced_attrs.postthis);jQuery("#itemeditor_evergreen").val(e.autotweet_advanced_attrs.evergreen);jQuery("#channelchooser").val(e.autotweet_advanced_attrs.channels);jQuery("#unix_mhdmd").val(e.autotweet_advanced_attrs.unix_mhdmd);t.UiHelper.resetBtnGroup("#itemeditor_postthis");t.UiHelper.resetBtnGroup("#itemeditor_evergreen")}};s.getHash=function(){var e=new Date,t;t=CryptoJS.MD5(""+e.getTime()+_.random(0,9007199254740992));t=CryptoJS.MD5(t+_.random(0,9007199254740992));t=CryptoJS.MD5(t+_.random(0,9007199254740992));return t};s.reset=function(){_.each(c,function(e){jQuery(".extly-body form [name='"+e.name+"']").val(e.value)});i.ref_id=s.getHash();i.plugin="autotweetpost";i.description="";i.url="";i.selectedMenuItem="";jQuery("#channelchooser").val([]);jQuery("#image_url-image").html("");r.$emit("loadAgenda",[]);t.UiHelper.resetBtnGroup("#itemeditor_postthis");t.UiHelper.resetBtnGroup("#itemeditor_evergreen")};s.jQueryReset=function(e){e.preventDefault();s.reset();a.$digest()};s.error=function(e){i.showDialog=true;i.messageResult=false;i.messageText=n.trustAsHtml("Error: "+e.status+" "+e.statusText);s.redirectOnSuccess=false;i.waiting=false};s.editRequest=function(e,t){var a,r={};e.preventDefault();if(!t){return}r["id"]=t;r["request_id"]=t;r["taskCommand"]="readAjaxAction";r["ajax"]=1;i.waiting=true;a=new l(r);a.$get(null,s.load,s.error)};s.publishRequest=function(e,t){var a,r={};e.preventDefault();if(!t){return}r["id"]=t;r["request_id"]=t;r["taskCommand"]="publishAjaxAction";r["ajax"]=1;i.waiting=true;a=new l(r);a.$save(null,s.success,s.error)};s.cancelRequest=function(e,t){var a,r={};e.preventDefault();if(!t){return}r["id"]=t;r["request_id"]=t;r["taskCommand"]="cancelAjaxAction";r["ajax"]=1;i.waiting=true;a=new l(r);a.$save(null,s.success,s.error)};s.backtoQueueRequest=function(t,a){var r,n={};e.preventDefault();if(!a){return}n["id"]=a;n["request_id"]=a;n["taskCommand"]="backtoQueueAjaxAction";n["ajax"]=1;i.waiting=true;r=new l(n);r.$save(null,s.success,s.error)};r.$on("editRequest",s.editRequest);r.$on("publishRequest",s.publishRequest);r.$on("cancelRequest",s.cancelRequest);r.$on("backtoQueueRequest",s.backtoQueueRequest);jQuery("#toolbar-apply button").attr("onclick",null).click(s.jQueryAddRequest);jQuery("#toolbar-save button").attr("onclick",null).click(s.jQueryAddRequestAndRedirect);jQuery("#toolbar-save-new button").attr("onclick",null).click(s.jQueryAddRequest);jQuery("#F0FHeaderHolder button:nth-of-type(1)").attr("onclick",null).click(s.jQueryAddRequest);jQuery("#F0FHeaderHolder button:nth-of-type(2)").attr("onclick",null).click(s.jQueryAddRequestAndRedirect);jQuery("#F0FHeaderHolder button:nth-of-type(3)").attr("onclick",null).click(s.jQueryAddRequest);jQuery("#toolbar-apply a").attr("onclick",null).click(s.jQueryAddRequest);jQuery("#toolbar-save a").attr("onclick",null).click(s.jQueryAddRequestAndRedirect);jQuery("#toolbar-save-new a").attr("onclick",null).click(s.jQueryAddRequest)};a.$inject=["$scope","$rootScope","$sce","Request"];return a});