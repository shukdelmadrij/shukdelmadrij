define("import",["extlycore"],function(t){"use strict";var e=t.ExtlyModel.extend({url:function(){return t.SefHelper.route("index.php?option=com_autotweet&view=feeds&task=getImportBegin")}}),s=t.ExtlyModel.extend({url:function(){return t.SefHelper.route("index.php?option=com_autotweet&view=feeds&task=getImportStatus")}}),o=t.ExtlyModel.extend({url:function(){return t.SefHelper.route("index.php?option=com_autotweet&view=feeds&task=getImportEnd")}}),r=Backbone.View.extend({events:{"click #toolbar-process button":"onImportBegin","click #toolbar-process .toolbar":"onImportBegin","click #cpanel-import":"onImportBegin"},initialize:function(){var t;t=this.$("#toolbar-process button"),t.attr("onclick",""),t.click(function(t){t.preventDefault()}),t=this.$("#toolbar-process .toolbar"),t.attr("onclick",""),t.click(function(t){t.preventDefault()}),t=this.$("#cpanel-import"),t.attr("onclick",""),t.click(function(t){t.preventDefault()}),this.resetBar(0)},onImportBegin:function(){var t=new e,s=this.$("#XTtoken").attr("name");this.$(".import-progress").removeClass("hide"),this.$(".import-progress .success-message").addClass("hide"),this.$("#toolbar-process button").addClass("disabled"),this.$("#toolbar-process .toolbar").addClass("disabled"),this.$("#cpanel-import").addClass("disabled"),t.on("change",this.loadImportBegin,this),t.fetch({data:{_token:s},wait:!0,dataType:"text",error:function(t,e,s){alert(e.responseText)}})},loadImportBegin:function(t){t.get("status")?(this.feeds=t.get("feeds"),this.nextFeed(),this.onImportStatus(0)):alert(t.get("error_message"))},onImportStatus:function(t){var e=new s,o=this.$("#XTtoken").attr("name");e.on("change",this.loadimportStatus,this),e.fetch({data:{_token:o,feedId:this.currentFeed.id,isContinue:t},wait:!0,dataType:"text",error:function(t,e,s){alert(e.responseText)}})},loadimportStatus:function(t){var e;t.get("status")?(e=t.get("completed"),this.assignTotal(t.get("total")),e?0===_.size(this.feeds)?this.onImportEnd():(this.nextFeed(),this.onImportStatus(0)):this.onImportStatus(1)):alert(t.get("error_message"))},onImportEnd:function(){var t=new o,e=this.$("#XTtoken").attr("name");t.on("change",this.loadImportEnd,this),t.fetch({data:{_token:e},wait:!0,dataType:"text",error:function(t,e,s){alert(e.responseText)}})},loadImportEnd:function(t){t.get("status")?(this.resetBar(100),this.$(".import-progress .success-message").removeClass("hide"),this.$("#toolbar-process button").removeClass("disabled"),this.$("#toolbar-process .toolbar").removeClass("disabled"),this.$("#cpanel-import").removeClass("disabled")):alert(t.get("error_message"))},assignFeedName:function(t){var e=this.$(".import-progress .feed");e.val(t)},assignTotal:function(t){var e=this.$(".import-progress .total");e.val(t)},resetBar:function(t){var e=this.$(".import-progress .bar");this.barImport=t?t:1,e.attr("style","width: "+this.barImport+"%;")},incBar:function(){var t=this.$(".import-progress .bar");this.barImport+=5,this.barImport>100?this.resetBar(0):t.attr("style","width: "+this.barImport+"%;")},nextFeed:function(){var t;this.currentFeed=_.first(this.feeds),this.feeds=_.rest(this.feeds),t=this.currentFeed.id+" - "+this.currentFeed.name,this.assignFeedName(t),this.assignTotal(0),this.incBar()}}),i=new r({el:jQuery("body")})});